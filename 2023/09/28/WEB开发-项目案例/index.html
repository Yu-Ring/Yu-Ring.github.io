<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>JavaWeb开发-项目-tlias笔记 | 洄游</title><meta name="author" content="YuRing"><meta name="copyright" content="YuRing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="个人根据黑马tlias项目的笔记记录">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb开发-项目-tlias笔记">
<meta property="og:url" content="https://yu-ring.github.io/2023/09/28/WEB%E5%BC%80%E5%8F%91-%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="洄游">
<meta property="og:description" content="个人根据黑马tlias项目的笔记记录">
<meta property="og:locale">
<meta property="og:image" content="https://pic-bed-e5v.pages.dev/img/%E7%A5%9E%E5%B7%9E%E6%8A%98%E5%89%9115.JPG">
<meta property="article:published_time" content="2023-09-27T17:49:00.000Z">
<meta property="article:modified_time" content="2023-12-21T00:39:14.000Z">
<meta property="article:author" content="YuRing">
<meta property="article:tag" content="WEB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic-bed-e5v.pages.dev/img/%E7%A5%9E%E5%B7%9E%E6%8A%98%E5%89%9115.JPG"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/%E5%87%89.GIF"><link rel="canonical" href="https://yu-ring.github.io/2023/09/28/WEB%E5%BC%80%E5%8F%91-%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JavaWeb开发-项目-tlias笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-21 08:39:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://pic-bed-e5v.pages.dev/img/头像/Mimikyu.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic-bed-e5v.pages.dev/img/神州折剑15.JPG')"><nav id="nav"><span id="blog-info"><a href="/" title="洄游"><span class="site-name">洄游</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JavaWeb开发-项目-tlias笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-27T17:49:00.000Z" title="Created 2023-09-28 01:49:00">2023-09-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-12-21T00:39:14.000Z" title="Updated 2023-12-21 08:39:14">2023-12-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">13.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>58min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JavaWeb开发-项目-tlias笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>完成智能学习辅助系统的<strong>部门管理</strong>和<strong>员工管理</strong><br>完成部门管理的 查询 新增 修改 删除<br>完成员工信息的 查询（条件分页） 新增 修改 删除</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014129.png" alt="image.png"></p>
<ul>
<li><p>准备数据库表 </p>
<blockquote>
<p>员工-部门：一对多结构 dept emp </p>
</blockquote>
</li>
<li><p>创建SpringBoot项目工程</p>
<blockquote>
<p>引入依赖：web起步依赖、Mybatis依赖（mybatis起步依赖+mysql驱动）、Lombok简化操作工具</p>
</blockquote>
</li>
<li><p>引入mybatis信息</p>
<blockquote>
<p>在配置文件<code>application.properties</code>中引入mybatis信息并准备相应的实体类</p>
</blockquote>
</li>
<li><p>准备3层解耦架构</p>
<blockquote>
<p>准备实体类对应的Mapper接口，Service（接口+实现类），Controller</p>
</blockquote>
</li>
</ul>
<h4 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h4><ul>
<li><p>引入数据源 创建tlias数据库 运行以下sql脚本快速构建数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (id, name, create_time, update_time) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;学工部&#x27;</span>,now(),now()),(<span class="number">2</span>,<span class="string">&#x27;教研部&#x27;</span>,now(),now()),(<span class="number">3</span>,<span class="string">&#x27;咨询部&#x27;</span>,now(),now()), (<span class="number">4</span>,<span class="string">&#x27;就业部&#x27;</span>,now(),now()),(<span class="number">5</span>,<span class="string">&#x27;人事部&#x27;</span>,now(),now());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工管理(带约束)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp (</span><br><span class="line">  id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">  username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">default</span> <span class="string">&#x27;123456&#x27;</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  gender tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别, 说明: 1 男, 2 女&#x27;</span>,</span><br><span class="line">  image <span class="type">varchar</span>(<span class="number">300</span>) comment <span class="string">&#x27;图像&#x27;</span>,</span><br><span class="line">  job tinyint unsigned comment <span class="string">&#x27;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;</span>,</span><br><span class="line">  entrydate <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">  dept_id <span class="type">int</span> unsigned comment <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">  create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp</span><br><span class="line">	(id, username, password, name, gender, image, job, entrydate,dept_id, create_time, update_time) <span class="keyword">VALUES</span></span><br><span class="line">	(<span class="number">1</span>,<span class="string">&#x27;jinyong&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;金庸&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;2000-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">2</span>,<span class="string">&#x27;zhangwuji&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2015-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">3</span>,<span class="string">&#x27;yangxiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;杨逍&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;3.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2008-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">4</span>,<span class="string">&#x27;weiyixiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;韦一笑&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;4.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2007-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">5</span>,<span class="string">&#x27;changyuchun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;常遇春&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;5.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2012-12-05&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">6</span>,<span class="string">&#x27;xiaozhao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;小昭&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;6.jpg&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">7</span>,<span class="string">&#x27;jixiaofu&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;纪晓芙&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;7.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2005-08-01&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">8</span>,<span class="string">&#x27;zhouzhiruo&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;8.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2014-11-09&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">9</span>,<span class="string">&#x27;dingminjun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;丁敏君&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;9.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2011-03-11&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">10</span>,<span class="string">&#x27;zhaomin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;赵敏&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;10.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">11</span>,<span class="string">&#x27;luzhangke&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹿杖客&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;11.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2007-02-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">12</span>,<span class="string">&#x27;hebiweng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹤笔翁&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;12.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2008-08-18&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">13</span>,<span class="string">&#x27;fangdongbai&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;方东白&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;13.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2012-11-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">14</span>,<span class="string">&#x27;zhangsanfeng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;14.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2002-08-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">15</span>,<span class="string">&#x27;yulianzhou&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;俞莲舟&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;15.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2011-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">16</span>,<span class="string">&#x27;songyuanqiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;宋远桥&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;16.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2007-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">17</span>,<span class="string">&#x27;chenyouliang&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;陈友谅&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;17.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;2015-03-21&#x27;</span>,<span class="keyword">NULL</span>,now(),now());</span><br></pre></td></tr></table></figure></li>
<li><p>创建项目<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014211.png" alt="image.png"></p>
</li>
<li><p>引入依赖<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014233.png" alt="image.png"></p>
</li>
<li><p>准备配置信息(数据库连接+mybatis配置以及驼峰映射开关)(username和password写你自己的数据库)</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/tlias</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1234</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl  </span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写实体类pojo（添加Lombok的注解）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  </span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dept</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Integer id;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;  </span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  </span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Integer id; <span class="comment">//ID  </span></span><br><span class="line">    <span class="keyword">private</span> String username; <span class="comment">//用户名  </span></span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">//密码  </span></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">//姓名  </span></span><br><span class="line">    <span class="keyword">private</span> Short gender; <span class="comment">//性别 , 1 男, 2 女  </span></span><br><span class="line">    <span class="keyword">private</span> String image; <span class="comment">//图像url  </span></span><br><span class="line">    <span class="keyword">private</span> Short job; <span class="comment">//职位 1 班主任 2 讲师 3 学工主管 4 教研主管 5 咨询师  </span></span><br><span class="line">    <span class="keyword">private</span> LocalDate entrydate; <span class="comment">//入职日期  </span></span><br><span class="line">    <span class="keyword">private</span> Integer deptId; <span class="comment">//部门ID  </span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime; <span class="comment">//创建时间  </span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime; <span class="comment">//修改时间  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写实体类对应的Service接口和实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpService</span> &#123;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptService</span> &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写Controller控制层</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写Mapper接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014300.png" alt="image.png"></p>
</li>
</ul>
<h4 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h4><ul>
<li><p>需要提供<strong>请求路径+请求方式+接口描述</strong></p>
</li>
<li><p>开发规范REST（REpresentational State Transfer）表述性状态转换<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014327.png" alt="image.png"><br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014344.png" alt="image.png"></p>
</li>
<li><p>统一响应结果Result类(pojo实体类下创建Result类)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  </span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Integer code;<span class="comment">//响应码，1 代表成功; 0 代表失败  </span></span><br><span class="line">    <span class="keyword">private</span> String msg;  <span class="comment">//响应信息 描述字符串  </span></span><br><span class="line">    <span class="keyword">private</span> Object data; <span class="comment">//返回的数据  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//增删改 成功响应  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">1</span>,<span class="string">&quot;success&quot;</span>,<span class="literal">null</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//查询 成功响应  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">1</span>,<span class="string">&quot;success&quot;</span>,data);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//失败响应  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>,msg,<span class="literal">null</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h4><p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20230928014420.png" alt="image.png"></p>
<h2 id="部门管理"><a href="#部门管理" class="headerlink" title="部门管理"></a>部门管理</h2><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>[[api接口文档#1.1 部门列表查询]]</p>
<blockquote>
<p>请求路径：&#x2F;depts<br>请求方式：GET<br>接口描述：该接口用于部门列表数据查询</p>
</blockquote>
<ul>
<li>思路<blockquote>
<p>浏览器前端 –&gt; Controller（接收+调用service+响应） –&gt; Service（完善实现类，调用Mapper接口） –&gt; Mapper（数据库语句） –&gt; 数据库</p>
</blockquote>
</li>
</ul>
<h6 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h6><ul>
<li>在Controller层中，以DeptController为例，暂不处理请求返回值<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/depts&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;  </span><br><span class="line">		<span class="comment">// 请求处理</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&#x3D;&#x3D;log记录处理方法：&#x3D;&#x3D;[[WEB开发-案例项目-附件#log记录]]<br>&#x3D;&#x3D;设置请求方式：&#x3D;&#x3D;[[WEB开发-案例项目-附件#设置请求方式]]</li>
<li>Controller层中调用注入Service接口，处理响应<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;  </span><br><span class="line">	</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/depts&quot;,method = RequestMethod.GET)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;  </span><br><span class="line">        log.info(<span class="string">&quot;查询全部部门数据&quot;</span>);  </span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.list();  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
&#x3D;&#x3D;实现类的方法快速生成：<code>alt+Enter</code>&#x3D;&#x3D;</li>
<li>Service层中，完善接口<code>List&lt;Dept&gt; list();</code>以及对应的实现类方法（<em>行数列表有按钮可快速跳转到实现类</em>），实现类中调用注入Mapper接口来查询数据库<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;  </span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> deptMapper.list();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>完善mapper接口的sql注解<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;  </span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * from dept&quot;)</span>  </span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>最后记得修改DeptController返回的方法<code>return Result.success(deptList);</code>修改响应返回值</li>
<li>利用Http请求工具测试GET <code>localhost:8080/depts</code></li>
</ul>
<h6 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h6><blockquote>
<p>通过访问前端工程来访问服务端程序，进而进行调试。</p>
</blockquote>
<ul>
<li>启动以及部署在nginx服务器的前端程序 <a href="localhost:90">访问</a></li>
</ul>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>[[api接口文档#1.2 删除部门]]</p>
<blockquote>
<p>请求路径：&#x2F;depts&#x2F;{id}<br>请求方式：DELETE<br>接口描述：该接口用于根据ID删除部门数据</p>
</blockquote>
<ul>
<li>思路<blockquote>
<p>浏览器前端 –&gt; Controller（接收(<code>@DeleteMapping</code>请求参数<code>@PathVariable</code> id)+调用service+响应） –&gt; Service（完善实现类，调用Mapper接口） –&gt; Mapper（数据库语句） –&gt; 数据库</p>
</blockquote>
</li>
</ul>
<h6 id="具体操作-1"><a href="#具体操作-1" class="headerlink" title="具体操作"></a>具体操作</h6><ul>
<li>Controller层处理接收，注解<code>@DeleteMapping(&quot;/depts/&#123;id&#125;&quot;)</code>，函数参数<code>@PathVariable Integer id</code>，调用注入Service接口，无需处理响应返回值<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;  </span><br><span class="line">	</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/depts/&#123;id&#125;&quot;)</span>  </span><br><span class="line">	<span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;  </span><br><span class="line">	    log.info(<span class="string">&quot;根据id删除部门：&#123;&#125;&quot;</span>,id);  <span class="comment">// &#123;&#125;表示参数占位符</span></span><br><span class="line">	    <span class="comment">// 调用service接口删除部门  </span></span><br><span class="line">	    deptService.delete(id);  </span><br><span class="line">	    <span class="keyword">return</span> Result.success();  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>到Service层中完善接口<code>void delete(Integer id);</code>，接口的实现类，并调用注入Mapper接口的sql删除语句<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;  </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span>  </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;  </span><br><span class="line">	    deptMapper.deleteById(id);  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>完善mapper的接口和sql注解<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;  </span><br><span class="line">    <span class="meta">@Delete(&quot;delete from dept where id = #&#123;id&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>利用Http请求工具测试 DELETE <code>localhost:8080/depts/5</code></li>
</ul>
<h6 id="前后端联调-1"><a href="#前后端联调-1" class="headerlink" title="前后端联调"></a>前后端联调</h6><ul>
<li>启动以及部署在nginx服务器的前端程序 <a href="localhost:90">访问</a></li>
<li>点击前端程序的删除</li>
</ul>
<h4 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h4><p>[[api接口文档#1.3 添加部门]]</p>
<blockquote>
<p>请求路径：&#x2F;depts<br>请求方式：POST<br>接口描述：该接口用于添加部门数据</p>
</blockquote>
<ul>
<li>思路<blockquote>
<p>浏览器前端 –&gt; Controller（接收(<code>@PostMapping</code>+封装实体类注解<code>@RequestBody</code>)+调用service+响应） –&gt; Service（完善实现类，调用Mapper接口） –&gt; Mapper（数据库语句） –&gt; 数据库</p>
</blockquote>
</li>
</ul>
<h6 id="具体操作-2"><a href="#具体操作-2" class="headerlink" title="具体操作"></a>具体操作</h6><ul>
<li>Controller层处理，注解<code>@PostMapping(&quot;/depts&quot;)</code>+参数<code>@RequestBody Dept dept</code>，调用Service接口，无需处理响应返回值<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;  </span><br><span class="line">	</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/depts&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;  </span><br><span class="line">        log.info(<span class="string">&quot;新增部门：&#123;&#125;&quot;</span>,dept);  </span><br><span class="line">        <span class="comment">// 调用service新增部门  </span></span><br><span class="line">        deptService.add(dept);  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Service层中完善接口<code>void add(Dept dept);</code>，接口的实现类完善其他属性信息，并调用注入Mapper接口<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;  </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span>  </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Dept dept)</span> &#123;  </span><br><span class="line">	    <span class="comment">//补全属性  </span></span><br><span class="line">	    dept.setCreateTime(LocalDateTime.now());  </span><br><span class="line">	    dept.setUpdateTime(LocalDateTime.now());  </span><br><span class="line">	    deptMapper.insert(dept);  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>完善mapper的接口和sql注解<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;  </span><br><span class="line">    <span class="meta">@Insert(&quot;insert into dept (name, create_time, update_time) values (#&#123;name&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;);&quot;)</span>  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dept dept)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>利用Http请求工具测试POST <code>localhost:8080/depts</code>, 并编写附带的JSON数据中<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;就业部&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="前后端联调-2"><a href="#前后端联调-2" class="headerlink" title="前后端联调"></a>前后端联调</h6><ul>
<li>打开ngnix的前端，选择增加部门，并查询数据库检查是否成功</li>
</ul>
<h4 id="路径优化"><a href="#路径优化" class="headerlink" title="路径优化"></a>路径优化</h4><p>对于Controller层的多个不同方式但具有公共的路径<code>&quot;/depts&quot;</code>的请求，可以抽取到类定义上<code>@RequestMapping(&quot;/depts&quot;)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/depts&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;  </span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.list();  </span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/depts/&#123;id&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;  </span><br><span class="line">        deptService.delete(id);  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/depts&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;  </span><br><span class="line">        deptService.add(dept);  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="meta">@RequestMapping(&quot;/depts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;  </span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping</span> </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;  </span><br><span class="line">        List&lt;Dept&gt; deptList = deptService.list();  </span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">	<span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span> </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;  </span><br><span class="line">        deptService.delete(id);  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">	<span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;  </span><br><span class="line">        deptService.add(dept);  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ID查询-自行实现"><a href="#ID查询-自行实现" class="headerlink" title="ID查询(自行实现)"></a>ID查询(自行实现)</h4><blockquote>
<p>请求路径：&#x2F;depts&#x2F;{id}<br>请求方式：GET<br>接口描述：该接口用于根据ID查询部门数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/depts/&#123;id&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">SearchById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;查询id部门：&#123;&#125;&quot;</span>,id);  </span><br><span class="line">    <span class="type">Dept</span> <span class="variable">depted</span> <span class="operator">=</span> deptService.searchById(id);  </span><br><span class="line">    <span class="keyword">return</span> Result.success(depted);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Dept <span class="title function_">searchById</span><span class="params">(Integer id)</span> &#123;  </span><br><span class="line">    <span class="type">Dept</span> <span class="variable">depted</span> <span class="operator">=</span> deptMapper.searchById(id);  </span><br><span class="line">    <span class="keyword">return</span> depted;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from dept where id = #&#123;id&#125;&quot;)</span>  </span><br><span class="line">Dept <span class="title function_">searchById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试请求GET <code>localhost:8080/depts/1</code></li>
</ul>
<h4 id="修改部门-自行实现"><a href="#修改部门-自行实现" class="headerlink" title="修改部门(自行实现)"></a>修改部门(自行实现)</h4><blockquote>
<p>请求路径：&#x2F;depts<br>请求方式：PUT<br>接口描述：该接口用于修改部门数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/depts&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">UpdateById</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;  </span><br><span class="line">    deptService.updateById(dept);  </span><br><span class="line">    <span class="keyword">return</span> Result.success();  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateById</span><span class="params">(Dept dept)</span> &#123;  </span><br><span class="line">    dept.setCreateTime(LocalDateTime.now());  </span><br><span class="line">    dept.setUpdateTime(LocalDateTime.now());  </span><br><span class="line">    deptMapper.updateById(dept);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update(&quot;update dept set name = #&#123;name&#125;, create_time = #&#123;createTime&#125;, update_time = #&#123;updateTime&#125; where id = #&#123;id&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateById</span><span class="params">(Dept dept)</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试请求PUT<code>localhost:8080/depts</code><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;教xue部&quot;</span> <span class="comment">//name是唯一键值，保证不要重复</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="员工管理"><a href="#员工管理" class="headerlink" title="员工管理"></a>员工管理</h2><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><blockquote>
<p>分页查询：<code>select * from [表名] limit [起始索引], [查询条数]</code></p>
</blockquote>
<ul>
<li>[[api接口文档#2.1 员工列表查询]]<blockquote>
<p>请求路径：&#x2F;emps<br>请求方式：GET<br>接口描述：该接口用于员工列表数据的条件分页查询</p>
</blockquote>
</li>
<li>思路<blockquote>
<p>前端需要后端同时返回两个数据：<em>总记录数<code>total</code>+列表数据<code>rows[]</code><em>。**前端  —(当前页码<code>pages</code>+每页展示记录数<code>pageSize</code>)—&gt; 后端</em></em><br>同时前端要向后端提供参数：<em>当前页码<code>pages</code>+数据列表<code>rows[]</code><em>。**后端  —(数据列表<code>rows[]</code>+总记录数<code>total</code>)—&gt; 前端</em></em><br><code>select * from emp limit ?, ?;</code><br><code>select count(*) from emp;</code><br>需要返回的数据类型有多个，考虑把<code>rows[]</code>和<code>total</code>封装到一个实体类<code>PageBean</code>中</p>
</blockquote>
</li>
</ul>
<h6 id="具体操作-3"><a href="#具体操作-3" class="headerlink" title="具体操作"></a>具体操作</h6><ul>
<li>定义<code>PageBean</code>实体类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@NoArgsConstructor</span>  </span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageBean</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Long total; <span class="comment">//总记录数  </span></span><br><span class="line">    <span class="keyword">private</span> List rows; <span class="comment">//数据列表  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Mapper接口两个sql语句<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;  </span><br><span class="line">    <span class="meta">@Select(&quot;select count(*) from emp;&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">count</span><span class="params">()</span>;  </span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp limit #&#123;start&#125;, #&#123;pageSize&#125;&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">page</span><span class="params">(Integer start, Integer pageSize)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Controller层接收<code>page</code>和<code>pageSize</code>参数，并设置默认值 [[WEB开发-案例项目-附件#Controller接收参数默认值]]，调用Service接口获取封装的<code>pagebean</code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> EmpService empService;  </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/emps&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page,  </span></span><br><span class="line"><span class="params">                       <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer pageSize)</span>&#123;  </span><br><span class="line">        log.info(<span class="string">&quot;分页查询，参数：&#123;&#125;, &#123;&#125;&quot;</span>, page, pageSize);  </span><br><span class="line">        <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> empService.page(page, pageSize);  </span><br><span class="line">        <span class="keyword">return</span> Result.success(pageBean);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>实现Service接口，调用Mapper接口获取数据，获取总记录数<code>count</code>和列表数据<code>empList</code>，并封装<code>pageBean</code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page, Integer pageSize)</span> &#123;  </span><br><span class="line">        <span class="comment">//1. 获取总记录数  </span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> empMapper.count();  </span><br><span class="line">        <span class="comment">//2. 获取分页查询结果列表  </span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">start</span> <span class="operator">=</span> (page - <span class="number">1</span>) * pageSize;  </span><br><span class="line">        List&lt;Emp&gt; empList = empMapper.page(start, pageSize);  </span><br><span class="line">        <span class="comment">//3. 封装PageBean对象  </span></span><br><span class="line">        <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(count, empList);  </span><br><span class="line">        <span class="keyword">return</span> pageBean;    </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>HTTP调试工具GET <code>localhost:8080/emps</code> 和 <code>localhost:8080/emps?page=2&amp;pageSize=5</code></li>
<li>Nginx前后端联调</li>
</ul>
<h6 id="分页插件PageHelper"><a href="#分页插件PageHelper" class="headerlink" title="分页插件PageHelper"></a>分页插件PageHelper</h6><blockquote>
<p>普通的分页查询中，Mapper层要调用复杂的条件查询+Service层调用Mapper层接口获取数据并处理参数和封装<br>Mybatis框架下提供了一个插件<code>PageHelper</code>，Mapper层只需要获取完整表(无条件查询)，在Service层通过<code>PageHelper.startPage(page,pageSize)</code>设置分页参数，通过<code>Page&lt;Emp&gt; p = (Page&lt;Emp&gt;) [完整表]</code>获取转化数据，最后封装即可。省去了处理过程。<br>本质是插件在service层转化数据时，自动运行并获取到了count数和条件查询列表数据</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Mapper层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from emp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li>
<li>Service层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page, Integer pageSize)</span>&#123;  </span><br><span class="line">    <span class="comment">//设置分页参数  </span></span><br><span class="line">    PageHelper.startPage(page,pageSize);  </span><br><span class="line">    <span class="comment">//查询  </span></span><br><span class="line">    Page&lt;Emp&gt; page1 = (Page&lt;Emp&gt;) empMapper.list();  </span><br><span class="line">    <span class="comment">//封装PageBean对象  </span></span><br><span class="line">    <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(page1.getTotal(),page1.getResult());  </span><br><span class="line">    <span class="keyword">return</span> pageBean;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="条件分页查询"><a href="#条件分页查询" class="headerlink" title="条件分页查询"></a>条件分页查询</h6><blockquote>
<p>条件查询员工：<code>select * from emp where name like concat (&#39;%&#39;,&#39;张&#39;,&#39;%&#39;) and gender = 1 and entrydate between &#39;2000-01-01&#39; and &#39;2010-01-01&#39; order by update_time desc</code></p>
</blockquote>
<ul>
<li>增加查询必要的参数：controller层增加参数以及必要的格式注解+service接口参数+mapper参数</li>
<li>mysql语句的动态映射xml<blockquote>
<p>新建一个目录，要求与mapper所在的com包目录保持一直。比如<code>com.yuring.mapper</code>，则在resources下定义目录<code>com/yuring/mapper</code>。xml文件名与对于java文件保持一致，<strong>同时要删去mapper接口的注释防止冲突</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span>  </span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>  </span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;[全类名]&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--  内容  --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;[方法名]&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;[全类名]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>通过select标签引入sql语句，并使用预编译参数占位符<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.tlias.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  内容  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.tlias.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from emp</span><br><span class="line">        where</span><br><span class="line">            name like concat (&#x27;%&#x27;,&#x27;#&#123;name&#125;&#x27;,&#x27;%&#x27;)</span><br><span class="line">          and gender = #&#123;gender&#125;</span><br><span class="line">          and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">        order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>由于有些参数不一定会传递，要进行动态sql化 <code>&lt;if&gt; &lt;where&gt;</code>标签，&#x3D;&#x3D;由于string值null和string空串<code>&quot;&quot;</code>并不相同，要做额外判断<code>and name != &#39;&#39;</code>&#x3D;&#x3D;<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span>  </span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>  </span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.tlias.mapper.EmpMapper&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!--  内容  --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.tlias.pojo.Emp&quot;</span>&gt;</span>  </span><br><span class="line">        select *  </span><br><span class="line">        from emp        <span class="tag">&lt;<span class="name">where</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">                name like concat (&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span>  </span><br><span class="line">                and gender = #&#123;gender&#125;  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span>  </span><br><span class="line">                and entrydate between #&#123;begin&#125; and #&#123;end&#125;  </span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span>  </span><br><span class="line">        order by update_time desc  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>HTTP测试接口<code>localhost:8080/emps?page=1&amp;pageSize=5&amp;name=张&amp;gender=1&amp;begin=2000-01-01&amp;end=2010-01-01</code></li>
<li>前后端联调</li>
</ul>
<h4 id="删除员工"><a href="#删除员工" class="headerlink" title="删除员工"></a>删除员工</h4><blockquote>
<p>批量删除：<code>delete from emp where id in (1,2,3)</code></p>
</blockquote>
<ul>
<li>[[api接口文档#2.2 删除员工]]<blockquote>
<p>请求路径：&#x2F;emps&#x2F;{ids}<br>请求方式：DELETE<br>接口描述：该接口用于批量删除员工的数据信息</p>
</blockquote>
</li>
<li>思路<blockquote>
<p>controller接收参数id+调用service+响应，service层调用mapper接口执行删除操作，Mapper使用动态sql进行映射(<code>&lt;foreach&gt;标签</code>)<br><code>&lt;foreach&gt;标签</code>：<code>&lt;foreach collection=&quot;遍历集合&quot; item=&quot;指代元素&quot; separator=&quot;元素间分割符&quot; open=&quot;开头拼接符&quot; close=&quot;结尾拼接符&quot;&gt;#&#123;id&#125;&lt;/foreach&gt;</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controller层</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/emps/&#123;ids&#125;&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Integer&gt; ids)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;删除部门，参数&#123;&#125;&quot;</span>, ids);  </span><br><span class="line">    empService.deleteById(ids);  </span><br><span class="line">    <span class="keyword">return</span> Result.success();  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//service层</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(List&lt;Integer&gt; ids)</span> &#123;  </span><br><span class="line">    empMapper.deleteById(ids);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Mapper.java</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(List&lt;Integer&gt; ids)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span>&gt;</span>  </span><br><span class="line">    delete from emp where id in  </span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span>#&#123;id&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>HTTP请求<br><code>localhost:8080/emps/15,16,17</code></li>
</ul>
<h4 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h4><ul>
<li>[[api接口文档#2.3 添加员工]]<blockquote>
<p>请求路径：&#x2F;emps<br>请求方式：POST<br>接口描述：该接口用于添加员工的信息</p>
</blockquote>
</li>
<li>思路<blockquote>
<p>controller接收数据封装参数<code>@PostMapping</code>+<code>@RequestBody</code>，service层补充实体类属性+调用mapper接口，Mapper使用动态sql进行映射</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Controller层</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/emps&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Emp emp)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;新增员工，emp：&#123;&#125;&quot;</span>,emp);  </span><br><span class="line">    empService.save(emp);  </span><br><span class="line">    <span class="keyword">return</span> Result.success();  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Service层</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Emp emp)</span> &#123;  </span><br><span class="line">    emp.setCreateTime(LocalDateTime.now());  </span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());  </span><br><span class="line">    empMapper.insert(emp);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Mapper层</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) &quot; +  </span></span><br><span class="line"><span class="meta">        &quot;values(#&#123;username&#125;,#&#123;name&#125;,#&#123;gender&#125;,#&#123;image&#125;,#&#123;job&#125;,#&#123;entrydate&#125;,#&#123;deptId&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;)&quot;)</span>  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Emp emp)</span>;</span><br></pre></td></tr></table></figure></li>
<li>HTTP请求<br><code>localhost:8080/emps</code><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://tlias.itheima.com/1.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;lingpingzhi&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;林平之&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;entrydate&quot;</span><span class="punctuation">:</span><span class="string">&quot;2015-09-18&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deptId&quot;</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><ul>
<li>前端<br>通过组件<code>&lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;</code> 外部使用<code>&lt;form action=[路径] method=[请求方式] enctype=[编码格式]&gt;</code><br>其中<strong>编码格式</strong>使用默认值<code>application/x-www-form-urlencoded</code><strong>只会上传文件的文件名</strong>，使用<code>multipart/form-data</code>上传可以使表单数据<strong>分多个部分进行提交</strong><blockquote>
<p>这里进行一个测试：在resource&gt;static下创建<code>upload.html</code> </p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span>  </span><br><span class="line">    姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span>  </span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span>  </span><br><span class="line">    头像：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span>&gt;</span>  </span><br><span class="line">    上传：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br></pre></td></tr></table></figure></li>
<li>后端<blockquote>
<p>Controller使用<code>MultipartFile image</code>接收图像数据 [[WEB开发-案例项目-附件#Controller接收参数名和前端不一致]]</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(String username, Integer age, MultipartFile image)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;，&#123;&#125;，&#123;&#125;&quot;</span>, username, age, image);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>前后端联动<blockquote>
<p>网页端输入<code>localhost:8080/upload.html</code>，启动后端，前端输入数据并提交。<br>后端debugger模式下可以查看上传的文件名和本地存放目录<br>![[Pasted image 20230926012400.png|400]]<br>其中image&gt;part&gt;location指示了临时文件存放目录，更改其为对应的文件类型或者txt可以看到 上传的文件 username age的值</p>
</blockquote>
</li>
</ul>
<h6 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h6><ul>
<li>在本地指定文件目录进行存储<blockquote>
<p>HTTP请求使用<code>form-data</code>类型<code>localhost:8080/upload</code>，选择文件<br>完成后会在对应的文件路径下发现前端发送的文件</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;  </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(String username, Integer age, MultipartFile image)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;，&#123;&#125;，&#123;&#125;&quot;</span>, username, age, image);  </span><br><span class="line">        <span class="comment">//将文件存储到服务器的磁盘目录中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();  </span><br><span class="line">        image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\MyWork\\SpringBoot_Learn\\img\\&quot;</span> + originalFilename));  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>本地存储<strong>优化</strong>——同名文件覆盖冲突<blockquote>
<p>如果向后端先后发送了两个不同的文件，但文件名相同。由于在同一个目录下，那么后上传的文件会覆盖掉先上传的文件<br><strong>通用唯一识别码(uuid)</strong>: 长度固定的字符串<br><code>aed2e87e-9229-4cae-b91f-845cdb7a0aec</code><br><code>31c49ad0-dccb-447c-ae65-52f61900c268</code><br><code>805ba17f-4897-4294-b94f-9f4373b4fd59</code><br><code>9e6a8e40-2072-458c-911e-1abbd3c4195d</code><br><code>afe1fe0a-7f81-461c-a998-7b4afe3d7d7d</code><br><code>8426bb6a-b60e-4cc5-9f1b-fff2f7d88278</code><br><strong>截取前端发送文件的后缀名，并拼接一个随机uuid</strong>。前后端联动后可以在指定本地文件路径下发现新的文件，且多次发送同一文件会有多份<br>&#x3D;&#x3D;有文件大小限制，后端默认不能接收超过1M的文件&#x3D;&#x3D; [[WEB开发-案例项目-附件#服务端接收的文件大小限制修改]]</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;  </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(String username, Integer age, MultipartFile image)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;，&#123;&#125;，&#123;&#125;&quot;</span>, username, age, image);  </span><br><span class="line">        <span class="comment">//将文件存储到服务器的磁盘目录中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//截取原文件包含点在内的后缀名&quot;.jpg&quot;  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>);  </span><br><span class="line">        <span class="type">String</span> <span class="variable">extname</span> <span class="operator">=</span> originalFilename.substring(index);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//与uuid拼接得到新的文件名  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newfilename</span> <span class="operator">=</span> UUID.randomUUID().toString() + extname;  </span><br><span class="line">        log.info(<span class="string">&quot;新的文件名：&#123;&#125;&quot;</span>, newfilename);  </span><br><span class="line">  </span><br><span class="line">        image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\MyWork\\SpringBoot_Learn\\img\\&quot;</span> + newfilename));  </span><br><span class="line">        <span class="keyword">return</span> Result.success();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="云存储——阿里云OSS"><a href="#云存储——阿里云OSS" class="headerlink" title="云存储——阿里云OSS"></a>云存储——阿里云OSS</h6><blockquote>
<p>毫无疑问，本地存储是已经被淘汰了的方式。接下来介绍云存储相关，<br><strong>阿里云对象存储服务OSS</strong>(Object Storage Service)，</p>
</blockquote>
<ul>
<li>[[WEB开发-案例项目-附件#阿里云OSS的基础配置]]<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231001060406.png" alt="image.png"></li>
<li>开发文件上传接口[[计算机&#x2F;4-WEB开发&#x2F;$_attachments&#x2F;api接口文档#2.6 文件上传]]<blockquote>
<p>请求路径：&#x2F;upload<br>请求方式：POST<br>接口描述：上传图片接口<br>参数格式：multipart&#x2F;form-data</p>
</blockquote>
</li>
</ul>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>image</td>
<td>file</td>
<td>是</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>引入工具类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOSSUtils</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> <span class="string">&quot;yuring-tlias&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 实现上传图片到OSS  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">     <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="comment">// 获取上传的文件的输入流  </span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 避免文件覆盖  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//上传文件到 OSS        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);  </span></span><br><span class="line">        ossClient.putObject(bucketName, fileName, inputStream);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//文件访问路径  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">0</span>] + <span class="string">&quot;//&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint.split(<span class="string">&quot;//&quot;</span>)[<span class="number">1</span>] + <span class="string">&quot;/&quot;</span> + fileName;  </span><br><span class="line">        <span class="comment">// 关闭ossClient  </span></span><br><span class="line">        ossClient.shutdown();  </span><br><span class="line">        <span class="keyword">return</span> url;<span class="comment">// 把上传到oss的路径返回  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>基于本地存储的代码进行修改<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> AliOSSUtils aliOSSUtils;  </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">upload</span><span class="params">(MultipartFile image)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;文件上传，：&#123;&#125;&quot;</span>,image.getOriginalFilename());  </span><br><span class="line">        <span class="comment">//调用阿里云oss工具类进行文件上传  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> aliOSSUtils.upload(image);  </span><br><span class="line">        log.info(<span class="string">&quot;文件上传成功，url:&#123;&#125;&quot;</span>,url);  </span><br><span class="line">        <span class="keyword">return</span> Result.success(url);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>启动后前端上传的文件会由后端发送到云端，后端同时返回url地址，且url地址会随着emp中image保存到数据库中</li>
</ul>
<h4 id="修改员工"><a href="#修改员工" class="headerlink" title="修改员工"></a>修改员工</h4><ul>
<li>查询回显<blockquote>
<p>一般修改页面要求先展示一下原来的数据，方便用户针对性修改，所以需要先查询选择需要修改员工的信息。由于查询比较简单，mapper采用普通的Mybatis用法即可</p>
</blockquote>
</li>
<li>[[api接口文档#2.4 根据ID查询]]<blockquote>
<p>请求路径：&#x2F;emps&#x2F;{id}<br>请求方式：GET<br>接口描述：该接口用于根据主键ID查询员工的信息</p>
</blockquote>
</li>
<li>修改员工</li>
<li>[[api接口文档#2.5 修改员工]]<blockquote>
<p>请求路径：&#x2F;emps<br>请求方式：PUT<br>接口描述：该接口用于修改员工的数据信息</p>
</blockquote>
</li>
<li>思路<blockquote>
<p>controller层接收对象参数，service层补充基本数据如更新时间，Mapper层用动态sql实现。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Controller层</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/emps/&#123;id&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;根据ID查询员工信息，id&#123;&#125;&quot;</span>,id);  </span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> empService.getById(id);  </span><br><span class="line">    <span class="keyword">return</span> Result.success(emp);  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@PutMapping(&quot;/emps&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Emp emp)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;更新员工信息：&#123;&#125;&quot;</span>,emp);  </span><br><span class="line">    empService.update(emp);  </span><br><span class="line">    <span class="keyword">return</span> Result.success();  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Service层</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> empMapper.getById(id);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span> &#123;  </span><br><span class="line">    emp.setUpdateTime(LocalDateTime.now());  </span><br><span class="line">    empMapper.update(emp);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mapper.java</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from emp where id = #&#123;id&#125;&quot;)</span>  </span><br><span class="line">Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//动态sql映射</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  Mapper.xml  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--更新员工--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span>  </span><br><span class="line">    update emp  </span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">            username = #&#123;username&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null and password != &#x27;&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">            password = #&#123;password&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">            name = #&#123;name&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span>  </span><br><span class="line">            gender = #&#123;gender&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null and image != &#x27;&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">            image = #&#123;image&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;job != null&quot;</span>&gt;</span>  </span><br><span class="line">            job = #&#123;job&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;entrydate != null&quot;</span>&gt;</span>  </span><br><span class="line">            entrydate = #&#123;entrydate&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptId != null&quot;</span>&gt;</span>  </span><br><span class="line">            dept_id = #&#123;deptId&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span>  </span><br><span class="line">            create_time = #&#123;createTime&#125;,  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>  </span><br><span class="line">            update_time = #&#123;updateTime&#125;  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span>  </span><br><span class="line">    where id = #&#123;id&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote>
<p>一些配置，如阿里云oss的accessKey如果直接分散定义在各个代码类中，后期修改时维护困难。<br>一般把这些信息配置在配置文件中，再由具体的代码类从中读取。</p>
</blockquote>
<ul>
<li>法一：通过<code>@Value</code>注入<blockquote>
<p>具体的类代码中，在需要注入的变量定义上注解<code>@Value(&amp;&#123;配置文件中的key&#125;)</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//AliOSSUtils.java类中</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">private</span> String endpoint;  </span><br><span class="line"><span class="meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">private</span> String accessKeyId;  </span><br><span class="line"><span class="meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">private</span> String accessKeySecret;  </span><br><span class="line"><span class="meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span>  </span><br><span class="line"><span class="keyword">private</span> String bucketName;</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">aliyun.oss.endpoint</span> = <span class="string">https://oss-cn-beijing.aliyuncs.com;  </span></span><br><span class="line"><span class="attr">aliyun.oss.accessKeyId</span> = <span class="string">?????;  </span></span><br><span class="line"><span class="attr">aliyun.oss.accessKeySecret</span> = <span class="string">??????????;  </span></span><br><span class="line"><span class="attr">aliyun.oss.bucketName</span> = <span class="string">yuring-tlias&quot;;</span></span><br></pre></td></tr></table></figure></li>
<li>debugger模式下观察运行机制<blockquote>
<p>后端debugger启动并在<code>InputStream inputStream = file.getInputStream();</code>打一个断点。<br>启动nginx通过<code>localhost:90</code>访问前端，添加一个图片。<br>后端断点提醒，显示当前变量已获取到配置文件的值。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231019145814.png" alt="image.png|600"></p>
</blockquote>
</li>
<li><code>yml/yaml</code>类型配置文件<blockquote>
<p>springboot框架下同时也支持yml&#x2F;yaml.。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231019151312.png" alt="image.png|400"></p>
</blockquote>
</li>
<li><code>yml/yaml</code>基本语法：<blockquote>
<p>大小写敏感<br>变量冒号后，数值前有空格<br>缩进表示层级关系，且不能使用Tab，必须使用空格<br>缩进空格数非严格，只需要同级的左对齐<br><code>#</code>表示行注释</p>
</blockquote>
</li>
<li><code>yml/yaml</code>数据格式：<blockquote>
<p>光标放在数据格式的对应元素上，idea下方会有光标显示相关信息</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#对象/Map集合：</span></span><br><span class="line"><span class="attr">user:</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">	<span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">	<span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数组/List/Set集合</span></span><br><span class="line"><span class="attr">hobby:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">java</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">C</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">game</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">sport</span></span><br></pre></td></tr></table></figure></li>
<li><code>properties</code> 替换成 <code>yml</code> 格式<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">  <span class="comment">#数据库连接配置  </span></span><br><span class="line">  <span class="attr">datasource:</span>  </span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span>  </span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/tlias</span>  </span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span>  </span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span>  </span><br><span class="line">  <span class="comment">#文件上传配置  </span></span><br><span class="line">  <span class="attr">servlet:</span>  </span><br><span class="line">    <span class="attr">multipart:</span>  </span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span>  </span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">100MB</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#Mybatis配置  </span></span><br><span class="line"><span class="attr">mybatis:</span>  </span><br><span class="line">  <span class="attr">configuration:</span>  </span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span>  </span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#阿里云OSS  </span></span><br><span class="line"><span class="attr">aliyun:</span>  </span><br><span class="line">  <span class="attr">oss:</span>  </span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">https://oss-cn-beijing.aliyuncs.com;</span>  </span><br><span class="line">    <span class="attr">accessKeyId:</span> <span class="string">?????;</span>  </span><br><span class="line">    <span class="attr">accessKeySecret:</span> <span class="string">??????????;</span>  </span><br><span class="line">    <span class="attr">bucketName:</span> <span class="string">yuring-tlias&quot;;</span></span><br></pre></td></tr></table></figure></li>
<li>法二：通过<code>@ConfigurationProperties(prefix=&quot;aliyun.oss&quot;)</code><blockquote>
<p>先引入依赖必要的<br>定义一个新类，添加 <code>@Data @Component @ConfigurationProperties</code> 使得数据交由bean容器管理，并和配置文件中的对应节点域上映射</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOSSProperties</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String endpoint;  </span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;  </span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;  </span><br><span class="line">    <span class="keyword">private</span> String bucketName;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOSSUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOSSProperties aliOSSProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> aliOSSProperties.getEndpoint();</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> aliOSSProperties.getAccessKeyId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> aliOSSProperties.getAccessKeySecret();</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> aliOSSProperties.getBucketName();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用对应配置元素</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>两个注解<code>@ConfigurationProperties</code>和<code>@Value</code>的比较<blockquote>
<p>同：都用来注入外部配置的属性<br>异：<code>@Value</code>只能一个一个的进行外部属性的注入；<code>@ConfigurationProperties</code>可以批量注入到bean对象中。</p>
</blockquote>
</li>
</ul>
<h2 id="基础登录"><a href="#基础登录" class="headerlink" title="基础登录"></a>基础登录</h2><h4 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h4><p>[[api接口文档#3.1.1 基本信息]]</p>
<blockquote>
<p>请求路径：&#x2F;login<br>请求方式：POST<br>接口描述：该接口用于员工登录Tlias智能学习辅助系统，登录完毕后，系统下发JWT令牌。 </p>
</blockquote>
<ul>
<li>实现思路<blockquote>
<p>LoginController: 接收并封装参数，调用service方法登录，响应<br>EmpService: 调用mapper<br>EmpMapper: <code>select * from emp username=? and password=?;</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//LoginController.java</span></span><br><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@RestController</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> EmpService empService;  </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Emp emp)</span>&#123;  </span><br><span class="line">        log.info(<span class="string">&quot;员工登录：&#123;&#125;&quot;</span>,emp);  </span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> empService.login(emp);  </span><br><span class="line">        <span class="keyword">return</span> emp1 != <span class="literal">null</span> ? Result.success() : Result.error(<span class="string">&quot;用户名或密码错误&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Service层</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">login</span><span class="params">(Emp emp)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> empMapper.getByUsernameAndPassword(emp);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mapper层</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from emp where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span>  </span><br><span class="line">Emp <span class="title function_">getByUsernameAndPassword</span><span class="params">(Emp emp)</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="登录校验"><a href="#登录校验" class="headerlink" title="登录校验"></a>登录校验</h4><blockquote>
<p>概述：虽然有了登陆界面来检验用户名是否正确并跳转到内部页面，但在网址上直接输入分页地址也可以直接获取后端数据，因此<strong>需要对退出或者未登录的请求访问进行用户校验</strong></p>
</blockquote>
<ul>
<li>统一拦截<blockquote>
<p>你也不想之前写的controller层代码全都得根据用户登陆没登陆做一次条件判断吧。为了简化重复繁琐的步骤，引入了一种统一拦截的技术。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231025022221.png" alt="image.png|650"></p>
</blockquote>
</li>
</ul>
<h5 id="会话技术"><a href="#会话技术" class="headerlink" title="会话技术"></a>会话技术</h5><ul>
<li>概述<blockquote>
<p>会话：用户打开浏览器访问web服务器，建立一次会话，一方断开（如关闭浏览器）就结束会话。一次会话包含多次请求和响应。<br>会话跟踪：一种维护浏览器状态的方法，服务器一般需要识别多次请求是否来自同一浏览器，以便在同一次会话的多次请求间共享数据。<br>会话跟踪方案：[[WEB开发-案例项目-附件#会话跟踪技术方案对比]]</p>
<ol>
<li>客户端会话跟踪技术：<strong>Cookie</strong> </li>
<li>服务端会话跟踪技术：<strong>Session</strong> </li>
<li>令牌技术：<strong>JWT</strong><br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231025023320.png" alt="image.png|650"></li>
</ol>
</blockquote>
</li>
<li>令牌技术<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231025034820.png" alt="image.png|800"></li>
<li>JWT令牌<blockquote>
<p><strong>定义</strong>： <strong>JSON WEB TOKEN</strong>: 用于在通信双方以<strong>json数据格式</strong>安全的传输信息。数字签名的存在使得这些信息是<strong>可靠的</strong>。<br><strong>特点</strong>：<em>简洁、自包含</em>：JWT的实体就是json经由令牌封装后的<strong>字符串</strong>(Base64编码)，并且携带身份认证信息。<br><strong>运行机制</strong>：客户端第一次发送请求给服务端后，服务端<strong>生成JWT令牌</strong>并相应给客户端。客户端保存JWT且后续请求都会携带令牌，而服务端每次接受请求都会<strong>校验令牌</strong>再放行。<br><strong>组成</strong>：</p>
<ol>
<li>Header: 令牌类型、签名算法</li>
<li>Payload: 自定义信息、数据等</li>
<li>Signature: header+payload+指定密钥，并通过签名算法计算而得<br>引用场景：登陆认证（生成+校验）[[WEB开发-案例项目-附件#JWT令牌的生成与校验测试]]<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231025103113.png" alt="image.png"></li>
</ol>
</blockquote>
</li>
</ul>
<h5 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h5><blockquote>
<p>引入依赖<br>JWT令牌操作工具类<br>登陆完成利用工具类生成令牌</p>
</blockquote>
<ul>
<li>引入jjwt依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>自定义Jwt工具类<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">signKey</span> <span class="operator">=</span> <span class="string">&quot;yuring&quot;</span>; <span class="comment">// 密钥  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Long</span> <span class="variable">expire</span> <span class="operator">=</span> <span class="number">43200000L</span>; <span class="comment">// 过期时间  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 生成JWT令牌  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> claims JWT的负载payload 中存储的内容  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回生成的令牌  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateJwt</span><span class="params">(Map&lt;String, Object&gt; claims)</span>&#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.builder()  </span><br><span class="line">                .addClaims(claims) <span class="comment">// 添加自定义数据  </span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, signKey) <span class="comment">// 自设签名密钥算法  </span></span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expire)) <span class="comment">// 设置过期时间ms  </span></span><br><span class="line">                .compact(); <span class="comment">// 生成并返回jwt令牌   </span></span><br><span class="line">		<span class="keyword">return</span> jwt;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 解析JWT令牌  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt 令牌  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回解析后 负载paylaod 中存储的自定义内容  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseJWT</span><span class="params">(String jwt)</span>&#123;  </span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser()  </span><br><span class="line">                .setSigningKey(signKey)  </span><br><span class="line">                .parseClaimsJws(jwt)  </span><br><span class="line">                .getBody();  </span><br><span class="line">        <span class="keyword">return</span> claims;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>修改Controller层<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Emp emp)</span>&#123;  </span><br><span class="line">    log.info(<span class="string">&quot;员工登录：&#123;&#125;&quot;</span>,emp);  </span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> empService.login(emp);  </span><br><span class="line">    <span class="comment">// 登陆成功 生成令牌 下发令牌  </span></span><br><span class="line">    <span class="keyword">if</span>(emp1 != <span class="literal">null</span>)&#123;  </span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">        claims.put(<span class="string">&quot;id&quot;</span>, emp1.getId());  </span><br><span class="line">        claims.put(<span class="string">&quot;name&quot;</span>, emp1.getName());  </span><br><span class="line">        claims.put(<span class="string">&quot;username&quot;</span>, emp1.getUsername());  </span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JwtUtils.generateJwt(claims);  </span><br><span class="line">        <span class="keyword">return</span> Result.success(jwt)  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// 登陆失败 返回错误信息  </span></span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="string">&quot;用户名或密码错误&quot;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>api调试工具或前端进行测试<blockquote>
<p>第一次请求得到的响应里会带有jwt<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231104181157.png" alt="image.png"><br>请求端后续发送请求会把jwt存放于请求头的token中<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231104180909.png" alt="image.png"></p>
</blockquote>
</li>
</ul>
<h5 id="过滤器Filter"><a href="#过滤器Filter" class="headerlink" title="过滤器Filter"></a>过滤器Filter</h5><ul>
<li>概述<blockquote>
<p>Filter过滤器， <strong>JavaWeb</strong> 三大组件之一。可以拦截对资源的请求，从而实现一些特殊的功能。<br>一般用于 登录校验、统一编码处理、敏感字符处理等<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231104181655.png" alt="image.png|650"></p>
</blockquote>
</li>
<li>基本思路<blockquote>
<p>在项目启动类上注解 <code>@ServletComponentScan</code><br>创建或继承一个Filter类，注解 <code>@WebFilter(urlPatterns = &quot;要拦截的路径&quot;)</code> , 实现 <code>init()</code>  <code>doFilter()</code>  <code>destopry()</code><br>处理<code>doFilter()</code>中的 <code>FilterChain.doFilter(request, response)</code>放行 的前后逻辑</p>
</blockquote>
</li>
<li>过滤器链<blockquote>
<p>如果有多个过滤器，会根据<strong>过滤器类名(字符串)的自然排序</strong>为顺序依次执行<strong>放行前逻辑</strong>、<strong>放行</strong>，访问到web资源后按栈反顺序执行<strong>放行后逻辑</strong>。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231105015333.png" alt="image.png|700"></p>
</blockquote>
</li>
<li>具体操作<blockquote>
<p>FIlter首先拦截所有请求。<br>对于login路径请求，要放行查询数据库是否成功登录，并生成返回一个jwt令牌。<br>如果是对资源的请求，要校验jwt令牌，成功才给放行。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;  </span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;  </span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;  </span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//1. 获取请求的url  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURI().toString();  </span><br><span class="line">        log.info(<span class="string">&quot;请求的url：&#123;&#125;&quot;</span>, url);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//2. 对登录请求，直接放行并生成jwt;  </span></span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;  </span><br><span class="line">            log.info(<span class="string">&quot;登陆操作，放行&quot;</span>);  </span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);  </span><br><span class="line">            <span class="keyword">return</span>;        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//3. 对资源请求（非登录请求），校验请求头token中的jwt令牌  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);  </span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123; <span class="comment">// 未登录情况  </span></span><br><span class="line">            log.info(<span class="string">&quot;请求头为空，返回未登录信息&quot;</span>);  </span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);  </span><br><span class="line">            <span class="comment">// 非Spring的Controller框架，直接返回Result并不会直接生成json 要手动转化  </span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);  </span><br><span class="line">            response.getWriter().write(notLogin);  </span><br><span class="line">            <span class="keyword">return</span>;        &#125;  </span><br><span class="line">        <span class="keyword">try</span> &#123; <span class="comment">// jwt解析失败情况  </span></span><br><span class="line">            JwtUtils.parseJWT(jwt);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            log.info(<span class="string">&quot;解析令牌失败，返回未登录错误信息&quot;</span>);  </span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);  </span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);  </span><br><span class="line">            response.getWriter().write(notLogin);  </span><br><span class="line">            <span class="keyword">return</span>;        &#125;  </span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);  </span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;  </span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="拦截器Interceptor"><a href="#拦截器Interceptor" class="headerlink" title="拦截器Interceptor"></a>拦截器Interceptor</h5><ul>
<li>概述<blockquote>
<p>拦截器 Interceptor，<strong>Spring框架</strong>中提供的用来动态拦截控制器方法的执行。</p>
</blockquote>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231105224148.png" alt="image.png|700"></p>
<ul>
<li>基本思路<blockquote>
<p>定义拦截器类继承HandlerInteceptor，<br>重写:<br><code>preHandler()</code>  目标资源方法执行前执行，返回结果表示是否放行<br><code>postHandler()</code>  目标资源方法运行之后运行<br><code>afterCompletion()</code>  视图渲染完毕后运行，最后运行<br>注册拦截器，继承WebMvcConfigurer，注解 <code>@Configuration</code>，注入定义的拦截器类，添加拦截路径<code>/**</code></p>
</blockquote>
</li>
<li>拦截资源<blockquote>
<p>相较于Filter，Interceptor用<code>addPathPatterns()</code>添加需要拦截的路径，同时支持排除不需要拦截的资源<code>excludePathPatterns()</code><br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231105231856.png" alt="image.png|900"></p>
</blockquote>
</li>
<li>执行流程<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231105235809.png" alt="image.png|800"><br>Filter过滤器会拦截所有的资源，Interceptor拦截器只能拦截Spring环境中的资源</li>
<li>具体操作<blockquote>
<p>自定义拦截器类并继承 <code>HandlerInterceptor</code> 处理逻辑和filter基本一致<br>注册拦截器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">//1. 获取请求的url  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getRequestURI().toString();  </span><br><span class="line">        log.info(<span class="string">&quot;请求的url：&#123;&#125;&quot;</span>, url);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//2. 对登录请求，直接放行  </span></span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;  </span><br><span class="line">            log.info(<span class="string">&quot;登陆操作，放行&quot;</span>);  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//3. 对资源请求（非登录请求），校验请求头token中的jwt令牌  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);  </span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123; <span class="comment">// 未登录情况  </span></span><br><span class="line">            log.info(<span class="string">&quot;请求头为空，返回未登录信息&quot;</span>);  </span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);  </span><br><span class="line">            <span class="comment">// 非Spring的Controller框架，直接返回Result并不会直接生成json 要手动转化  </span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);  </span><br><span class="line">            response.getWriter().write(notLogin);  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;        &#125;  </span><br><span class="line">        <span class="keyword">try</span> &#123; <span class="comment">// jwt解析失败情况  </span></span><br><span class="line">            JwtUtils.parseJWT(jwt);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            log.info(<span class="string">&quot;解析令牌失败，返回未登录错误信息&quot;</span>);  </span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);  </span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);  </span><br><span class="line">            response.getWriter().write(notLogin);  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;        &#125;  </span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        HandlerInterceptor.<span class="built_in">super</span>.postHandle(request, response, handler, modelAndView);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        HandlerInterceptor.<span class="built_in">super</span>.afterCompletion(request, response, handler, ex);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> LoginCheckInterceptor loginCheckInterceptor;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span>&#123;  </span><br><span class="line">        registry.addInterceptor(loginCheckInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/login&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><blockquote>
<p>项目开发工程中各层不可避免的会遇到异常现象，但返回结果常常并非统一响应结果规范。（发生异常的层会不断向上层抛出异常，最终返回也是个异常）。<br>我们需要捕获这些异常，并返回统一规范结果的响应。</p>
</blockquote>
<ul>
<li>解决方案<blockquote>
<p>在Controller层进行try-catch处理，但每个controller调用都需要处理，比较繁琐。<br>一般使用<strong>全局异常处理器</strong>。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231106013815.png" alt="image.png|500"></p>
</blockquote>
</li>
<li>全局异常处理器<blockquote>
<p>注解<code>@RestControllerAdvice</code> ( 包含<code>@ControllerAdvice</code>+<code>@ResponseBody</code><em>(返回值自动转为json)</em> ) 表明该类为全局异常处理器<br>注解<code>@ExceptionHandler(类)</code>为方法知名要捕获异常的类，类&#x3D;<code>Exception.class</code>表示捕获所有异常</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span>  </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">ex</span><span class="params">(Exception ex)</span>&#123;  </span><br><span class="line">        ex.printStackTrace();  </span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;对不起，操作失败，请联系管理员&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h2><h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><ul>
<li>概述<blockquote>
<p><strong>事务</strong>：一组操作的集合，不可分割的工作单位，这些操作要么同时成功，要么同时失败。</p>
</blockquote>
</li>
<li>场景说明<blockquote>
<p>以下图为例，先完善部门Service层删除的功能，即删除部门后同时删除该部门下的员工。<br>但如果中间发生错误，会删除部门但后续工作没有进行。即使代码改正过后原来的数据已经被删除而无法进行。<br>因此需要保证这两个操作在同一个事务中。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231106185015.png" alt="image.png"></p>
</blockquote>
</li>
</ul>
<h4 id="Spring事务管理-Transactional"><a href="#Spring事务管理-Transactional" class="headerlink" title="Spring事务管理 @Transactional"></a>Spring事务管理 <code>@Transactional</code></h4><ul>
<li>基本用法<blockquote>
<p>事务管理 <code>@Transactional</code> 注解于业务层Service的方法、类、接口上。同时可以在yml配置文件上配置相关事务管理日志。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;  </span><br><span class="line">    deptMapper.deleteById(id); <span class="comment">// 根据ID删除部门数据  </span></span><br><span class="line">    <span class="comment">//此处为可能发生一定的错误的代码  </span></span><br><span class="line">    empMapper.deleteByDeptId(id); <span class="comment">// 根据部门ID删除部门下的员工信息  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#spring 事务管理日志  </span></span><br><span class="line"><span class="attr">logging:</span>  </span><br><span class="line">  <span class="attr">level:</span>  </span><br><span class="line">    <span class="attr">org.springframework.jdbc.support.JdbcTransactionManager:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></li>
<li>回滚属性rollbackFor<blockquote>
<p>默认情况下，只有出现<code>RuntimeException</code>才回滚异常，注解<code>@Transactional</code>的rollbackFor属性用于控制出现何种异常类型回滚事务。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span>  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;  </span><br><span class="line">    deptMapper.deleteById(id); <span class="comment">// 根据ID删除部门数据  </span></span><br><span class="line">    <span class="comment">//此处为可能发生一定的错误的代码  </span></span><br><span class="line">    empMapper.deleteByDeptId(id); <span class="comment">// 根据部门ID删除部门下的员工信息  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>传播属性propagation<blockquote>
<p><strong>事务传播行为</strong>：一个事务方法被另一个事务方法调用时，因该进行何种事务控制<br>通过属性propagation来指定传播行为。<br>使用场景举例：如果说A方法需要处理删除功能添加了注解<code>@Transactional</code>，其中try-catch-final中调用了B方法写日志时同样注解了<code>@Transactional</code>。如果出现了异常，由于默认的属性因为A存在而把日志操作加入A的事务中，会导致A整个方法包括B方法写好的日志行为全部回滚。这里需要B方法在注解中定义传播属性 <code>@Transactional(propagation=REQUIRES_NEW)</code> ,原事务回滚前会挂机并创建新事务执行日志操作。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231107004258.png" alt="image.png|800"></p>
</blockquote>
</li>
</ul>
<h2 id="面向切面编程AOP"><a href="#面向切面编程AOP" class="headerlink" title="面向切面编程AOP"></a>面向切面编程AOP</h2><h4 id="AOP基本操作"><a href="#AOP基本操作" class="headerlink" title="AOP基本操作"></a>AOP基本操作</h4><ul>
<li>概述<blockquote>
<p><strong>AOP</strong>：Aspect Oriented Programming(面向切面编程、面向方向编程)，面向特定若干个方法编程。<br>使用场景：项目中部分有些功能运行较慢，定位执行耗时时间较长的业务方法，此时就需要统计每一个业务方法的执行耗时。AOP通过一个模板提取统计耗时的操作。<br>实现：实现的主流方式时<strong>动态代理</strong>，而SpringAOP是Spring框架的高级技术，旨在管理bean对象的过程中，主要通过底层的动态代理机制，对特定的方法进行编程。</p>
</blockquote>
</li>
<li>SpringAOP基本用法<blockquote>
<p>导入依赖<br>编写AOP程序 定义类注解 <code>@Component</code> <code>@Aspect</code>，内部方法注解<code>@Around(&quot;execution(* com.yuring.service,*,*(..))&quot;)</code> execution(“包名.类&#x2F;接口名.方法”)</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--AOP--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">// AOP类  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeAspect</span> &#123;  </span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.tlias.service.*.*(..))&quot;)</span> <span class="comment">// 切入点表达式  </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        <span class="comment">// 1.记录考试时间  </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 2.调用原始方法运行  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 3.记录结束时间，计算方法执行耗时  </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();  </span><br><span class="line">        log.info(joinPoint.getSignature()+<span class="string">&quot;方法耗时时间：&#123;&#125;ms&quot;</span>,end-begin);  </span><br><span class="line">        <span class="keyword">return</span> result;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231107115552.png" alt="image.png|1000"></li>
</ul>
<h4 id="AOP核心概念"><a href="#AOP核心概念" class="headerlink" title="AOP核心概念"></a>AOP核心概念</h4><h6 id="专业名词"><a href="#专业名词" class="headerlink" title="专业名词"></a>专业名词</h6><ul>
<li>连接点：JoinPoint，可以被AOP控制的方法。(暗含方法执行时的相关信息。)</li>
<li>通知：Advice，指那些重复的逻辑，也就是共性功能（最终体现为一个方法)</li>
<li>切入点：PointCut，匹配连接点的条件，通知金辉在切入点方法执行时被应用。</li>
<li>切面类：Aspect，描述通知与切入点的对应关系（通知+切入点）</li>
<li>目标对象：Target，通知所应用的对象。<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231107120517.png" alt="image.png|1000"></li>
</ul>
<h6 id="AOP执行流程"><a href="#AOP执行流程" class="headerlink" title="AOP执行流程"></a>AOP执行流程</h6><blockquote>
<p>首先，程序运行时，系统会基于动态代理自动的为目标对象创建一个代理对象，代理对象中会对目标对象的原始方法进行一定的”增强”。而原本要用目标对象注入的程序会<strong>用代理对象取代注入</strong>。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231107120811.png" alt="image.png|1000"></p>
<h4 id="AOP进阶"><a href="#AOP进阶" class="headerlink" title="AOP进阶"></a>AOP进阶</h4><h6 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h6><ul>
<li><code>@Around</code> : 通过JoinPoint标注目标方法，进而确定目标方法前后要进行的操作</li>
<li><code>@Before</code> : 在所有目标方法前执行标注的方法</li>
<li><code>@After</code> : 在所有目标方法后执行标注的方法，且不受异常影响</li>
<li><code>@AfterReturing</code> : 在所有目标方法后执行，有异常就不执行</li>
<li><code>@AfterThrowing</code> : 在所有目标方法后执行，有异常才执行<br>切入点表达式简化：通知类型中一般都需要写<code>execution(* 类名.*(..))</code>，可以通过<code>@Pointcut</code>来简化这一操作<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Aspect</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect1</span> &#123;  </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.tlias.service.impl.DeptServiceImpl.*(..))&quot;)</span>  <span class="comment">// 抽取 切入点表达式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;before ...&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;around before ...&quot;</span>);  </span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();  </span><br><span class="line">        log.info(<span class="string">&quot;around after ...&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> result;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@After(&quot;pt()&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;  </span><br><span class="line">        log.info(<span class="string">&quot;after ...&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="通知顺序"><a href="#通知顺序" class="headerlink" title="通知顺序"></a>通知顺序</h6><blockquote>
<p>当有多个切面的切入点都匹配到了目标方法，目标方法运行时，多个通知方法都会被执行。<br>通知顺序却决于切面类类名，before和after执行顺序类似于栈的关系<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231108003319.png" alt="image.png|600"><br>可以通过在切面类上注解<code>@Order(数字)</code> 来控制顺序，一个类的order数字越小，before顺序越靠前，after顺序越靠后。</p>
</blockquote>
<h6 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h6><blockquote>
<p>切入点表达式：描述切入点方法的一种表达式 <code>@Pointcut(...)</code><br>作用：主要用来决定项目中哪些方法需要加入通知<br>常见形式：<br><code>execution(...)</code> 根据方法的签名来匹配<br><code>@annotation(...)</code>  根据注解匹配</p>
</blockquote>
<ul>
<li><p><code>execution(...)</code> </p>
<blockquote>
<p>主要根据目标方法的返回值、包名、类名、方法名、方法等信息来匹配<br><code>execution(访问修饰符? 返回值 包名.类名.?方法名(方法参数) throws 异常?)</code><br><em>?表示可以省略，但包名类名一般不省略</em><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231108010219.png" alt="image.png|800"><br>通配符描述：&#x3D;&#x3D;（单个位置不是只有一个<code>*</code>的而是组合的，如  <code>*service</code> ，可以表示为以service结尾的所有参数)&#x3D;&#x3D;<img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231108010659.png" alt="image.png|900"><br>&#x3D;&#x3D;<em>如果要定位多个目标方法，还可以使用 <code>||</code> 进行连接</em>&#x3D;&#x3D;<img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231108011408.png" alt="image.png|800"></p>
</blockquote>
</li>
<li><p><code>@annotation(...)</code></p>
<blockquote>
<p>用于匹配表示有特定注解的方法<br>具体步骤：</p>
<ol>
<li>自定义一个注解描述，并注解 生效标识<code>@Retention(生效情况)</code> 可作用范围<code>@Target()</code></li>
<li>在目标方法上添加自己定义的注解</li>
<li>在切面类的切入点表达式方法的注解<code>@Pointcut(&quot;@Annotation(自定义注解全类名)&quot;)</code></li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="连接点"><a href="#连接点" class="headerlink" title="连接点"></a>连接点</h6><blockquote>
<p><strong>连接点</strong>：被AOP控制的方法。<br>在Spring中使用 <code>JoinPoint</code> 抽象了连接点，可以用JoinPoint来<strong>调用被控制方法的参数</strong>，如目标类名、方法名、方法参数等 还包括<strong>放行</strong>等操作。<br><strong>注意</strong>：<code>@Around</code> 通知获取连接点信息只能用<code>ProceedingJoinPoint</code> ，其他通知类型只能用 <code>JoinPoint</code>。 <code>JoinPoint</code>是<code>ProceedingJoinPoint</code>的父类型</p>
</blockquote>
<h4 id="AOP案例"><a href="#AOP案例" class="headerlink" title="AOP案例"></a>AOP案例</h4><h6 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h6><blockquote>
<p>需求：将案例中所有的crud相关接口的操作日志记录在数据库表中。日志信息包含：操作人、操作时间、执行方法的全类名、执行方法名、方法运行时的参数、返回值、方法执行时长。<br>思路分析：</p>
<ol>
<li>对所有Service层业务类的增删改查添加统一功能，使用AOP技术最为方便。<code>@Around</code> 环绕通知</li>
<li>也可以用自定义注解<code>@Annotation</code>对无明确命名规则的目标方法进行注解。</li>
</ol>
</blockquote>
<h6 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h6><ul>
<li>准备<blockquote>
<p>案例工程中引入AOP起步依赖<br>导入资料中准备好的数据库表结构，以及对应的实体类</p>
</blockquote>
</li>
<li>编码<blockquote>
<p>自定义注解<code>@Log</code><br>定义AOP切面类，完成记录操作日志的逻辑<br>在需要的方法上注解<code>@Log</code></p>
</blockquote>
</li>
</ul>
<h6 id="具体操作-4"><a href="#具体操作-4" class="headerlink" title="具体操作"></a>具体操作</h6><ul>
<li>引入依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--AOP--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>sql脚本导入数据库表<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 操作日志表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> operate_log(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    operate_user <span class="type">int</span> unsigned comment <span class="string">&#x27;操作人ID&#x27;</span>,</span><br><span class="line">    operate_time datetime comment <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">    class_name <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;操作的类名&#x27;</span>,</span><br><span class="line">    method_name <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;操作的方法名&#x27;</span>,</span><br><span class="line">    method_params <span class="type">varchar</span>(<span class="number">1000</span>) comment <span class="string">&#x27;方法参数&#x27;</span>,</span><br><span class="line">    return_value <span class="type">varchar</span>(<span class="number">2000</span>) comment <span class="string">&#x27;返回值&#x27;</span>,</span><br><span class="line">    cost_time <span class="type">bigint</span> comment <span class="string">&#x27;方法执行耗时, 单位:ms&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;操作日志表&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li>引入对应的实体类 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperateLog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">private</span> Integer operateUser; <span class="comment">//操作人ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime operateTime; <span class="comment">//操作时间</span></span><br><span class="line">    <span class="keyword">private</span> String className; <span class="comment">//操作类名</span></span><br><span class="line">    <span class="keyword">private</span> String methodName; <span class="comment">//操作方法名</span></span><br><span class="line">    <span class="keyword">private</span> String methodParams; <span class="comment">//操作方法参数</span></span><br><span class="line">    <span class="keyword">private</span> String returnValue; <span class="comment">//操作方法返回值</span></span><br><span class="line">    <span class="keyword">private</span> Long costTime; <span class="comment">//操作耗时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>添加支持日志添加操作的Mapper接口 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OperateLogMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入日志数据</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into operate_log (operate_user, operate_time, class_name, method_name, method_params, return_value, cost_time) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;values (#&#123;operateUser&#125;, #&#123;operateTime&#125;, #&#123;className&#125;, #&#123;methodName&#125;, #&#123;methodParams&#125;, #&#123;returnValue&#125;, #&#123;costTime&#125;);&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(OperateLog log)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>自定义注解，anno目录下定义 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="comment">// 运行时生效  </span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span> <span class="comment">// 作用在方法上  </span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建切面类，aop目录下创建 <code>LogAspect</code> <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="meta">@Component</span>  </span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">// 切面类  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;  </span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;<span class="comment">//获取改次请求的请求头信息  </span></span><br><span class="line">    <span class="meta">@Autowired</span>  </span><br><span class="line">    <span class="keyword">private</span> OperateLogMapper operateLogMapper;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(com.example.tlias.anno.Log)&quot;)</span> <span class="comment">// 切入点表达式-annotation形式  </span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordLog</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123; <span class="comment">// 连接点  </span></span><br><span class="line">        <span class="comment">//操作人ID-当前登陆员工ID  </span></span><br><span class="line">        <span class="comment">// 获取请求头中的jwt令牌 解析令牌  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);  </span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.parseJWT(jwt);  </span><br><span class="line">        <span class="type">Integer</span> <span class="variable">operateUser</span> <span class="operator">=</span> (Integer) claims.get(<span class="string">&quot;id&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//操作时间  </span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">operateTime</span> <span class="operator">=</span> LocalDateTime.now();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//操作类名  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getName();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//操作方法名  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//操作方法参数  </span></span><br><span class="line">        Object[] args = joinPoint.getArgs();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">methodParams</span> <span class="operator">=</span> Arrays.toString(args);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();  </span><br><span class="line">        <span class="comment">// -- 调用目标方法 --        </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();  </span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();  </span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法返回值  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">returnValue</span> <span class="operator">=</span> JSONObject.toJSONString(result);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">//操作耗时  </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">costTime</span> <span class="operator">=</span> end - begin;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 记录操作日志  </span></span><br><span class="line">        <span class="type">OperateLog</span> <span class="variable">operateLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OperateLog</span>(<span class="literal">null</span>, operateUser, operateTime, className, methodName, methodParams, returnValue, costTime);  </span><br><span class="line">        operateLogMapper.insert(operateLog);  </span><br><span class="line">        log.info(<span class="string">&quot;AOP记录操作日志: &#123;&#125;&quot;</span>, operateLog);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> result;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在目标方法上添加<code>@Log</code><blockquote>
<p>在所有的增删改的controller层方法上添加注解<code>@Log</code> ，使得每个增删改请求都会进行一次日志记录操作，可以在数据库中operate_log查询到。</p>
</blockquote>
</li>
</ul>
<h2 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h2><h4 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h4><ul>
<li>配置文件<blockquote>
<p><strong>配置文件优先级</strong> properties &gt; <strong>yml</strong> &gt; ymal<br>Springboot除了支持配置文件属性配置，同时还支持Java系统属性和命令行参数的方法进行属性配置。</p>
</blockquote>
</li>
<li>系统配置<blockquote>
<p>Java系统属性<br>命令行参数<br><strong>优先级</strong>：命令行参数 &gt; Java系统属性&gt;配置文件</p>
<ol>
<li>IDEA内配置<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231116145853.png" alt="image.png"></li>
<li>已打包项目进行配置属性的指定<br><code>java [option] -jar &lt;jar文件&gt; [args...]</code><br><code>java -Dserver.port=9000 -jar tlias-web-management-0.0.1-SNAPSHOT.jar --server.port=10010</code></li>
</ol>
</blockquote>
</li>
</ul>
<h4 id="Bean管理"><a href="#Bean管理" class="headerlink" title="Bean管理"></a>Bean管理</h4><h5 id="Bean的获取"><a href="#Bean的获取" class="headerlink" title="Bean的获取"></a>Bean的获取</h5><blockquote>
<p>默认情况下，Spring项目启动时，会把bean都创建好放在IOC容器中。</p>
</blockquote>
<ul>
<li>注入容器对象</li>
<li>获取bean<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  </span><br><span class="line"><span class="keyword">private</span> ApplicationContext applicationContext; <span class="comment">// IOC容器对象  </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBean</span><span class="params">()</span>&#123;  </span><br><span class="line">    <span class="comment">// 根据bean的名称获取  </span></span><br><span class="line">    <span class="type">DeptController</span> <span class="variable">bean1</span> <span class="operator">=</span> (DeptController) applicationContext.getBean(<span class="string">&quot;deptController&quot;</span>);  </span><br><span class="line">    System.out.println(bean1);  </span><br><span class="line">    <span class="comment">// 根据bean的类型获取  </span></span><br><span class="line">    <span class="type">DeptController</span> <span class="variable">bean2</span> <span class="operator">=</span> (DeptController) applicationContext.getBean(DeptController.class);  </span><br><span class="line">    System.out.println(bean2);  </span><br><span class="line">    <span class="comment">// 根据bean的 名称 及 类型 获取  </span></span><br><span class="line">    <span class="type">DeptController</span> <span class="variable">bean3</span> <span class="operator">=</span> (DeptController) applicationContext.getBean(<span class="string">&quot;deptController&quot;</span>, DeptController.class);  </span><br><span class="line">    System.out.println(bean3);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
上述都是默认的单例非延迟加载的bean，实际还会受到作用域和延迟初始化影响。</li>
</ul>
<h5 id="Bean作用域"><a href="#Bean作用域" class="headerlink" title="Bean作用域"></a>Bean作用域</h5><ul>
<li><p>Spring支持五种作用域，后三种在web环境才会生效</p>
<table>
<thead>
<tr>
<th>作用域</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;&#x3D;singleton&#x3D;&#x3D;</td>
<td>容器内同名称的bean、只有一个实例(单例)（默认），容器启动时才被创建</td>
</tr>
<tr>
<td>&#x3D;&#x3D;prototype&#x3D;&#x3D;</td>
<td>每次使用该bean时都会创建新的实例(非单例)</td>
</tr>
<tr>
<td>request</td>
<td>每个请求范围内都会创建新的实例</td>
</tr>
<tr>
<td>session</td>
<td>每个会话范围内都会创建新的实例</td>
</tr>
<tr>
<td>application</td>
<td>每个应用范围内都会创建新的实例</td>
</tr>
</tbody></table>
</li>
<li><p>可以通过<code>@Scope</code>注解来进行配置作用域（Controller层的类上方）：</p>
</li>
<li><p>技巧：使用<code>@Lazy</code>注解可以延迟Controller实例的初始化，使得其在被第一次调用的时候才初始化</p>
</li>
<li><p>实际开发中，绝大部分的Bean都是单例的，即绝大多数Bean不需要配置scope属性</p>
</li>
</ul>
<h5 id="第三方bean"><a href="#第三方bean" class="headerlink" title="第三方bean"></a>第三方bean</h5><blockquote>
<p>如果要使用的bean对象来自第三方，那么<strong>每次调用都需要先创建一次该对象的实例</strong>，比较耗费资源。因此希望通过spring框架的IOC容器进行管理以减少资源消耗。</p>
</blockquote>
<p><strong>问题</strong>：但是在<strong>第三方只读类上无法进行<code>@Component</code>的注解</strong>，不可以直接用<code>@Component</code>或其衍生注解声明bean。<br><strong>解决方法</strong>：对于第三方的、无法用<code>@Component</code>进行注解声明bean的，可以通过<code>@Bean</code>注解，使其方法的返回值交给Spring的IOC容器管理。</p>
<blockquote>
<p>以xml的解析为例 首先pom.xml中添加<code>dom4j</code>相关依赖 resource中添加一个<code>1.xml</code>文件测试用</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">emp</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Tom<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>18<span class="tag">&lt;/<span class="name">age</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">emp</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>为了方便演示在Springboot的启动类中要用到的第三方类上注解 <code>@Bean</code> ，使得项目启动时，该类的对象就被交给IOC对象管理</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootWebConfig2Application</span>&#123; <span class="comment">// 项目启动时 调用</span></span><br><span class="line">	<span class="meta">@Bean</span> <span class="comment">// 将方法返回值交给IOC容器管理，成为IOC容器的Bean对象</span></span><br><span class="line">	<span class="keyword">public</span> SAXReader <span class="title function_">saxReader</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在测试类中注入调用该方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  </span><br><span class="line"><span class="keyword">private</span> SAXReader saxReader;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 第三方bean的管理  </span></span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testThirdBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> saxReader.read(<span class="built_in">this</span>.getClass().getClassLoader().getResource(<span class="string">&quot;1.xml&quot;</span>));  </span><br><span class="line">    <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> document.getRootElement();  </span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rootElement.element(<span class="string">&quot;name&quot;</span>).getText();  </span><br><span class="line">    <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> rootElement.element(<span class="string">&quot;age&quot;</span>).getText();  </span><br><span class="line">  </span><br><span class="line">    System.out.println(name+ <span class="string">&quot;:&quot;</span> + age);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启动测试类，通过debug方式可以看出saxReader被交给IOC容器并注入到测试类中</p>
</blockquote>
<p><strong>注意：实际使用中IOC的操作并不在启动类中使用，而是在配置类中声明第三方bean对象</strong>: 项目下创建config目录 添加以下配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 配置类  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> &#123;  </span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//声明第三方bean对象 将当前方法的返回值对象交给IOC容器管理，成为IOC容器的bean  </span></span><br><span class="line">    <span class="keyword">public</span> SAXReader <span class="title function_">saxReader</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>@Component</code>及衍生注解 一般可以指定该类IOC后的bean名字，默认为类名首字母小写。而<code>@Bean</code>也可以通过<code>name</code> 和 <code>value</code>属性进行指定，<strong>未指定默认为方法名</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 可以通过该方法测试 通过bean名获取对象</span></span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBean</span><span class="params">()</span>&#123;  </span><br><span class="line">    <span class="comment">// 根据bean的名称获取  </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean1</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;saxReader&quot;</span>);  </span><br><span class="line">    System.out.println(bean1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231128024720.png" alt="image.png|500"></p>
</li>
<li><p>在声明第三方bean对象时，如果<strong>还要注入自定义对象，无需<code>@Autowired</code> 直接在声明方法的形参中添加即可</strong> 容器会自动装配</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 配置类  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonConfig</span> &#123;  </span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//声明第三方bean对象 将当前方法的返回值对象交给IOC容器管理，成为IOC容器的bean  </span></span><br><span class="line">    <span class="keyword">public</span> SAXReader <span class="title function_">saxReader</span><span class="params">(DeptService deptService)</span>&#123;</span><br><span class="line">	    System.out.println(deptService);  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="SpringBoot原理-1"><a href="#SpringBoot原理-1" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h4><h5 id="起步依赖"><a href="#起步依赖" class="headerlink" title="起步依赖"></a>起步依赖</h5><ul>
<li>springboot依赖的<code>spring-boot-starter-web</code>集成了spring相关的所有依赖（<strong>依赖传递</strong>）<br><img src="https://cdn.jsdelivr.net/gh/Yu-Ring/obsidian/20231128100649.png" alt="image.png|400"></li>
</ul>
<h5 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h5><ul>
<li>当Spring容器启动后，一些配置类<code>Configuration</code>、<code>bean</code>对象就自动存入到IOC容器中，不需要手动去声明，简化开发。</li>
<li>配置类<code>@Configuration</code>本身也是<code>@Component</code>注解的容器</li>
<li>哪些类要使用，只用通过<code>@Autowired</code>进行注入</li>
<li>Spring项目启动后，扫描的范围为该项目下及其子包<blockquote>
<p>方案一：<code>@ComponentScan(&#123;&quot;com.example&quot;,&quot;com.itheima&quot;&#125;)</code> <em>内部可以是String单值也可以是String数组</em> <strong>缺点：繁琐，所有第三方依赖都得一个一个写进去，大面积扫描性能低</strong><br>方案二：<code>@Import</code>导入<br>普通类：直接注解导入，无需添加其他注解，直接交给IOC容器管理，成为容器的bean对象 <code>@Import(&#123;TokenParser.class&#125;)</code><br>配置类：配置类被导入后，其中所含的所有bean对象也会一起交给IOC容器管理 <code>@Import(&#123;HeaderConfig.class&#125;)</code><br>接口实现类ImportSelector：用一个类MyImportSelector实现接口<code>ImportSelector</code>返回要交给IOC容器管理的<strong>全类名</strong>String数组<br>    (如<code>return new String[] &#123;&quot;com.example.HeaderConfig&#125;&quot;</code>)，然后再启动类上注解<code>@Import(&#123;&quot;MyImportSelector.class&quot;&#125;)</code> </p>
</blockquote>
</li>
</ul>
<p>	</p>
<h2 id="Maven高级"><a href="#Maven高级" class="headerlink" title="Maven高级"></a>Maven高级</h2><h2 id="Mybatis-Plus-相关"><a href="#Mybatis-Plus-相关" class="headerlink" title="Mybatis Plus 相关"></a>Mybatis Plus 相关</h2><ul>
<li>注意生成的实体层的每个主键对应的属性都需添加<code>@TableId(type = IdType.AUTO)</code><br>具体类似如下：<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@TableName</span> user  </span></span><br><span class="line"><span class="comment"> */</span><span class="meta">@TableName(value =&quot;user&quot;)</span>  </span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;  </span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span>  </span><br><span class="line">    <span class="keyword">private</span> Long userId;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String account;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String password;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String avatar;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String email;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String phone;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Integer status;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Integer activityLevel;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 0:学生 1:老师  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">private</span> Integer role;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Integer deleted;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@TableField(exist = false)</span>  </span><br><span class="line">    <span class="keyword">private</span> String token;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName(value =&quot;dish&quot;)</span>  </span><br><span class="line"><span class="meta">@Data</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dish</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;  </span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span>  </span><br><span class="line">    <span class="keyword">private</span> Long dishId;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Long cafeteriaId;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String cafeteriaName;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String cuisine;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String imageUrl;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Integer status;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> Integer deleted;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://yu-ring.github.io">YuRing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://yu-ring.github.io/2023/09/28/WEB%E5%BC%80%E5%8F%91-%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/">https://yu-ring.github.io/2023/09/28/WEB开发-项目案例/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WEB/">WEB</a></div><div class="post_share"><div class="social-share" data-image="https://pic-bed-e5v.pages.dev/img/神州折剑15.JPG" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/28/%E8%87%AA%E6%88%91%E5%90%8C%E4%B8%80%E6%80%A7/" title="自我同一性"><img class="cover" src="https://pic-bed-e5v.pages.dev/img/神州折剑13.JPG" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">自我同一性</div></div></a></div><div class="next-post pull-right"><a href="/2023/09/13/Git/" title="Git基础"><img class="cover" src="https://pic-bed-e5v.pages.dev/img/神州折剑12.JPG" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Git基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/03/22/%E5%90%8E%E7%AB%AFWeb%E5%BC%80%E5%8F%91/" title="Java后端Web开发"><img class="cover" src="https://pic-bed-e5v.pages.dev/img/神州折剑10.JPG" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-22</div><div class="title">Java后端Web开发</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://pic-bed-e5v.pages.dev/img/头像/Mimikyu.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YuRing</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Yu-Ring"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Yu-Ring" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1807169624@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.0.1.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.0.2.</span> <span class="toc-text">具体步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">2.0.3.</span> <span class="toc-text">接口文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.0.4.</span> <span class="toc-text">开发流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">部门管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.0.1.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.0.1.0.1.</span> <span class="toc-text">具体操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">3.0.1.0.2.</span> <span class="toc-text">前后端联调</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">3.0.2.</span> <span class="toc-text">删除</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C-1"><span class="toc-number">3.0.2.0.1.</span> <span class="toc-text">具体操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83-1"><span class="toc-number">3.0.2.0.2.</span> <span class="toc-text">前后端联调</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E"><span class="toc-number">3.0.3.</span> <span class="toc-text">新增</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C-2"><span class="toc-number">3.0.3.0.1.</span> <span class="toc-text">具体操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83-2"><span class="toc-number">3.0.3.0.2.</span> <span class="toc-text">前后端联调</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E4%BC%98%E5%8C%96"><span class="toc-number">3.0.4.</span> <span class="toc-text">路径优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ID%E6%9F%A5%E8%AF%A2-%E8%87%AA%E8%A1%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.0.5.</span> <span class="toc-text">ID查询(自行实现)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%83%A8%E9%97%A8-%E8%87%AA%E8%A1%8C%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.0.6.</span> <span class="toc-text">修改部门(自行实现)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">员工管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.0.1.</span> <span class="toc-text">分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C-3"><span class="toc-number">4.0.1.0.1.</span> <span class="toc-text">具体操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6PageHelper"><span class="toc-number">4.0.1.0.2.</span> <span class="toc-text">分页插件PageHelper</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.0.1.0.3.</span> <span class="toc-text">条件分页查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%91%98%E5%B7%A5"><span class="toc-number">4.0.2.</span> <span class="toc-text">删除员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-number">4.0.3.</span> <span class="toc-text">新增员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.0.4.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-number">4.0.4.0.1.</span> <span class="toc-text">本地存储</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%91%E5%AD%98%E5%82%A8%E2%80%94%E2%80%94%E9%98%BF%E9%87%8C%E4%BA%91OSS"><span class="toc-number">4.0.4.0.2.</span> <span class="toc-text">云存储——阿里云OSS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%91%98%E5%B7%A5"><span class="toc-number">4.0.5.</span> <span class="toc-text">修改员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.0.6.</span> <span class="toc-text">配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%99%BB%E5%BD%95"><span class="toc-number">5.</span> <span class="toc-text">基础登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">5.0.1.</span> <span class="toc-text">登录功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">5.0.2.</span> <span class="toc-text">登录校验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF"><span class="toc-number">5.0.2.1.</span> <span class="toc-text">会话技术</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">5.0.2.2.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8Filter"><span class="toc-number">5.0.2.3.</span> <span class="toc-text">过滤器Filter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8Interceptor"><span class="toc-number">5.0.2.4.</span> <span class="toc-text">拦截器Interceptor</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">5.0.3.</span> <span class="toc-text">异常处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">6.0.1.</span> <span class="toc-text">事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-Transactional"><span class="toc-number">6.0.2.</span> <span class="toc-text">Spring事务管理 @Transactional</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8BAOP"><span class="toc-number">7.</span> <span class="toc-text">面向切面编程AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">7.0.1.</span> <span class="toc-text">AOP基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">7.0.2.</span> <span class="toc-text">AOP核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%93%E4%B8%9A%E5%90%8D%E8%AF%8D"><span class="toc-number">7.0.2.0.1.</span> <span class="toc-text">专业名词</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#AOP%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">7.0.2.0.2.</span> <span class="toc-text">AOP执行流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E8%BF%9B%E9%98%B6"><span class="toc-number">7.0.3.</span> <span class="toc-text">AOP进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.0.3.0.1.</span> <span class="toc-text">通知类型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E9%A1%BA%E5%BA%8F"><span class="toc-number">7.0.3.0.2.</span> <span class="toc-text">通知顺序</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.0.3.0.3.</span> <span class="toc-text">切入点表达式</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%82%B9"><span class="toc-number">7.0.3.0.4.</span> <span class="toc-text">连接点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E6%A1%88%E4%BE%8B"><span class="toc-number">7.0.4.</span> <span class="toc-text">AOP案例</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-1"><span class="toc-number">7.0.4.0.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">7.0.4.0.2.</span> <span class="toc-text">操作流程</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C-4"><span class="toc-number">7.0.4.0.3.</span> <span class="toc-text">具体操作</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%8E%9F%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">SpringBoot原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">8.0.1.</span> <span class="toc-text">配置优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bean%E7%AE%A1%E7%90%86"><span class="toc-number">8.0.2.</span> <span class="toc-text">Bean管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Bean%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">8.0.2.1.</span> <span class="toc-text">Bean的获取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Bean%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">8.0.2.2.</span> <span class="toc-text">Bean作用域</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9bean"><span class="toc-number">8.0.2.3.</span> <span class="toc-text">第三方bean</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot%E5%8E%9F%E7%90%86-1"><span class="toc-number">8.0.3.</span> <span class="toc-text">SpringBoot原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">8.0.3.1.</span> <span class="toc-text">起步依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">8.0.3.2.</span> <span class="toc-text">自动配置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Maven%E9%AB%98%E7%BA%A7"><span class="toc-number">9.</span> <span class="toc-text">Maven高级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis-Plus-%E7%9B%B8%E5%85%B3"><span class="toc-number">10.</span> <span class="toc-text">Mybatis Plus 相关</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/09/28/%E8%87%AA%E6%88%91%E5%90%8C%E4%B8%80%E6%80%A7/" title="自我同一性"><img src="https://pic-bed-e5v.pages.dev/img/神州折剑13.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自我同一性"/></a><div class="content"><a class="title" href="/2023/09/28/%E8%87%AA%E6%88%91%E5%90%8C%E4%B8%80%E6%80%A7/" title="自我同一性">自我同一性</a><time datetime="2023-09-27T17:49:00.000Z" title="Created 2023-09-28 01:49:00">2023-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/28/WEB%E5%BC%80%E5%8F%91-%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/" title="JavaWeb开发-项目-tlias笔记"><img src="https://pic-bed-e5v.pages.dev/img/神州折剑15.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaWeb开发-项目-tlias笔记"/></a><div class="content"><a class="title" href="/2023/09/28/WEB%E5%BC%80%E5%8F%91-%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/" title="JavaWeb开发-项目-tlias笔记">JavaWeb开发-项目-tlias笔记</a><time datetime="2023-09-27T17:49:00.000Z" title="Created 2023-09-28 01:49:00">2023-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/13/Git/" title="Git基础"><img src="https://pic-bed-e5v.pages.dev/img/神州折剑12.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git基础"/></a><div class="content"><a class="title" href="/2023/09/13/Git/" title="Git基础">Git基础</a><time datetime="2023-09-13T02:44:00.000Z" title="Created 2023-09-13 10:44:00">2023-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/13/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="微信小程序"><img src="https://pic-bed-e5v.pages.dev/img/神州折剑15.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微信小程序"/></a><div class="content"><a class="title" href="/2023/09/13/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="微信小程序">微信小程序</a><time datetime="2023-09-13T02:44:00.000Z" title="Created 2023-09-13 10:44:00">2023-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/22/5.0-%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" title="背包问题导论"><img src="https://pic-bed-e5v.pages.dev/img/神州折剑12.JPG" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="背包问题导论"/></a><div class="content"><a class="title" href="/2023/03/22/5.0-%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" title="背包问题导论">背包问题导论</a><time datetime="2023-03-22T12:00:00.000Z" title="Created 2023-03-22 20:00:00">2023-03-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic-bed-e5v.pages.dev/img/神州折剑15.JPG')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By YuRing</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">我又回到了洄游之中</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><div class="aplayer" data-id="9084935986" data-server="netease" data-type="playlist" data-order="list" data-fixed="true" data-preload="auto" data-autoplay="true" data-theme="#3F51B5"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="头发-1,头发-1,头发-1,头发-1,头发-1024" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>